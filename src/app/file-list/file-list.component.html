<app-setting #appSetting (settingChange)="onSettingChange($event)"></app-setting>
<p-toast></p-toast>
<p-confirmPopup></p-confirmPopup>
<section class="home-section">
  <div class="container-fluid">
    <div class="row justify-content-between">
      <div class="col-12  mb-3">
        <p-fileUpload #fileUpload invalidFileSizeMessageDetail="Max file size is {{maxFileSize/1000000}} MB"
          [maxFileSize]="maxFileSize" [accept]="fileTypeAllowed" [customUpload]="true"
          (uploadHandler)="uploadFileHandler($event)"></p-fileUpload>
      </div>
    </div>
    <div class="row">
      <div class="col-12 mb-5">
        <div class="card card-block card-stretch card-height">
          <div class="car-body">
            <div class="table-responsive">
              <table class=" table mb-0 table-borderless tbl-server-info">
                <thead>
                  <tr>
                    <th>#</th>
                    <th style="width: 300px;" scope="col">File Name</th>
                    <th scope="col">Type</th>
                    <th scope="col">Version</th>
                    <th scope="col">File Size</th>
                    <th scope="col">Create time</th>
                    <th style="text-align: center;" scope="col">Download</th>
                    <th style="text-align: center;" scope="col">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let file of files| paginate: {
                      itemsPerPage: noItems,
                      currentPage: currentPg
                    }; let i = index">
                    <tr *ngIf="file.numberOfVersion >=1">
                      <td [attr.rowspan]="file.numberOfVersion + 1"> <b>{{i+1}}</b> </td>
                      <td [attr.rowspan]="file.numberOfVersion + 1">{{file.name}}</td>
                      <td [attr.rowspan]="file.numberOfVersion + 1">{{file.mime}}</td>
                    </tr>
                    <ng-container *ngFor="let version of file.fileVersions; let i= index;">
                      <tr *ngIf="!version.deleted">
                        <td> {{version.version}} </td>
                        <td> {{version.fileSize |fileSize}} </td>
                        <td> {{version.createdAt | date: 'medium'}} </td>
                        <td style="text-align: center;"> {{version.numberOfDownload}} </td>
                        <td style="text-align: center;">
                          <button pButton class="p-button-rounded p-button-text p-button-lg" type="button"
                            icon="pi pi-download" iconPos="left"
                            (click)="onDownloadFile(file.name, version.id)"></button>
                          <button pButton style="color: #dc3545;" class="p-button-rounded p-button-text p-button-lg"
                            type="button" icon="pi pi-trash" iconPos="left"
                            (click)="onConfirmDelete($event, file.name, version.id)"></button>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="background-color: rgb(194, 150, 55);" class="row pt-2 justify-content-around fixed-bottom">
      <pagination-controls class="col-9" (pageChange)="currentPg=$event"></pagination-controls>
      <div class="col-3 item-per-page">
        <button 
                pButton 
                class="col  p-button-rounded p-button-lg p-0" 
                type="button" icon="pi pi-cog"
                iconPos="left" 
                (click)="toggleSetting($event)"></button>
        Items per page:
        <button (click)="dec()" class="btn p-1 btn-primary"><i class='bx bx-minus'></i></button>
        <input style="width: 30px; height: 30px;" class="input p-1 mx-2" [value]="noItems">
        <button (click)="inc()" class="btn p-1 btn-primary"><i class='bx bx-plus'></i></button>
        
      </div>
     
    </div>
  </div>

</section>